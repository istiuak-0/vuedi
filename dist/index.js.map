{"version":3,"sources":["../src/libs/types.ts","../src/libs/registry.ts","../src/decorators/register.ts","../src/functions/resolve.ts","../src/functions/resolve-instance.ts","../src/plugin/vuedi.plugin.ts","../src/functions/expose-children.ts","../src/functions/resolve-context.ts"],"sourcesContent":["export type ServiceConstructor<T = unknown> = {\r\n  new (): T;\r\n};\r\nexport type ServiceConfig = {\r\n  in: 'app';\r\n};\r\n\r\nexport interface Disposable {\r\n  dispose(): void;\r\n}\r\n\r\nexport function ImplementsDispose(instance: unknown) {\r\n  return typeof (instance as any).dispose === 'function';\r\n}\r\n\r\nexport type ServiceWithDispose<T> = T & {\r\n  dispose(): void;\r\n};\r\n","import type { ServiceConstructor } from './types';\r\n\r\nexport const serviceRegistry = new Map<ServiceConstructor, InstanceType<ServiceConstructor>>();\r\nexport const SERVICE_INTERNAL_METADATA = Symbol('VUEDI_SERVICE_METADATA');\r\n","import { SERVICE_INTERNAL_METADATA } from '../libs/registry';\r\nimport type { ServiceConfig, ServiceConstructor } from '../libs/types';\r\n\r\nexport function Register<T extends ServiceConfig>(config: T) {\r\n  return function <C extends ServiceConstructor>(constructor: C) {\r\n    (constructor as any)[SERVICE_INTERNAL_METADATA] = config;\r\n    return constructor;\r\n  };\r\n}\r\n","import { SERVICE_INTERNAL_METADATA, serviceRegistry } from '../libs/registry';\r\nimport {\r\n  type ServiceConfig,\r\n  type ServiceConstructor,\r\n} from '../libs/types';\r\n\r\n/// this will only be used fro global services\r\nexport function resolve<T extends ServiceConstructor>(serviceClass: T): InstanceType<T> {\r\n  let config = (serviceClass as any)[SERVICE_INTERNAL_METADATA] as ServiceConfig;\r\n\r\n  if (!config) {\r\n    throw new Error('No Config Metadate Found, Make Sure To Use @Register() in global Service Classes');\r\n  }\r\n\r\n  if (serviceRegistry.has(serviceClass)) {\r\n    return serviceRegistry.get(serviceClass) as InstanceType<T>;\r\n  } else {\r\n    const instance = new serviceClass();\r\n    serviceRegistry.set(serviceClass, instance);\r\n    return instance as InstanceType<T>;\r\n  }\r\n}\r\n","import { getCurrentInstance, onScopeDispose } from 'vue';\r\nimport { ImplementsDispose, type ServiceConstructor, type ServiceWithDispose } from '../libs/types';\r\n\r\nexport function resolveInstance<T extends ServiceConstructor>(serviceClass: T): InstanceType<T> {\r\n  let instance = new serviceClass();\r\n  const componentInstance = getCurrentInstance();\r\n\r\n  if (componentInstance) {\r\n    onScopeDispose(() => {\r\n      if (ImplementsDispose(instance)) {\r\n        try {\r\n          (instance as ServiceWithDispose<typeof instance>).dispose();\r\n        } catch (error) {\r\n          console.error('Error in scope dispose:', error);\r\n        }\r\n      }\r\n      instance = null;\r\n    });\r\n  }\r\n\r\n  return instance as InstanceType<T>;\r\n}\r\n","import type { FunctionPlugin } from 'vue';\r\nimport { serviceRegistry } from '../libs/registry';\r\nimport type { ServiceConstructor } from '../libs/types';\r\n\r\n\r\ntype VueDIOptions = {\r\n  services: ServiceConstructor[];\r\n};\r\n\r\nexport const vuedi: FunctionPlugin<[Partial<VueDIOptions>?]> = (_app, options?: Partial<VueDIOptions>) => {\r\n  ///Eagerly create instances\r\n  if (options?.services) {\r\n    options.services.forEach(item => {\r\n      const serviceInstance = serviceRegistry.has(item);\r\n      if (!serviceInstance) {\r\n        serviceRegistry.set(item, new item());\r\n      }\r\n    });\r\n  }\r\n};\r\n","import { getCurrentInstance, onScopeDispose, provide } from 'vue';\r\nimport { ImplementsDispose, type ServiceConstructor, type ServiceWithDispose } from '../libs/types';\r\n\r\nexport function exposeToChildren<T extends ServiceConstructor>(classOrInstance: T | InstanceType<T>): void {\r\n  let instance: any;\r\n  let shouldCleanUp = false;\r\n\r\n  if (typeof classOrInstance === 'function') {\r\n    instance = new (classOrInstance as T)();\r\n    shouldCleanUp = true;\r\n  } else {\r\n    // No need to clean up here\r\n    instance = classOrInstance;\r\n  }\r\n\r\n  const constructor = instance.constructor as ServiceConstructor;\r\n  provide(constructor.name, instance);\r\n\r\n  if (shouldCleanUp) {\r\n    const componentInstance = getCurrentInstance();\r\n\r\n    if (componentInstance) {\r\n      onScopeDispose(() => {\r\n        if (ImplementsDispose(instance)) {\r\n          try {\r\n            (instance as ServiceWithDispose<T>).dispose();\r\n          } catch (error) {\r\n            console.error('Error in context service onUnmounted:', error);\r\n          }\r\n        }\r\n        instance = null;\r\n      });\r\n    }\r\n\r\n  }\r\n}\r\n\r\n","import { inject } from 'vue';\r\nimport type { ServiceConstructor } from '../libs/types';\r\n\r\nexport function resolveFromContext<T extends ServiceConstructor>(serviceClass: T): InstanceType<T> | undefined {\r\n  return inject<InstanceType<T>>(serviceClass.name);\r\n}\r\n"],"mappings":";;;AAWO,SAAS,kBAAkB,UAAmB;AACnD,SAAO,OAAQ,SAAiB,YAAY;AAC9C;;;ACXO,IAAM,kBAAkB,oBAAI,IAA0D;AACtF,IAAM,4BAA4B,uBAAO,wBAAwB;;;ACAjE,SAAS,SAAkC,QAAW;AAC3D,SAAO,SAAwC,aAAgB;AAC7D,IAAC,YAAoB,yBAAyB,IAAI;AAClD,WAAO;AAAA,EACT;AACF;;;ACDO,SAAS,QAAsC,cAAkC;AACtF,MAAI,SAAU,aAAqB,yBAAyB;AAE5D,MAAI,CAAC,QAAQ;AACX,UAAM,IAAI,MAAM,kFAAkF;AAAA,EACpG;AAEA,MAAI,gBAAgB,IAAI,YAAY,GAAG;AACrC,WAAO,gBAAgB,IAAI,YAAY;AAAA,EACzC,OAAO;AACL,UAAM,WAAW,IAAI,aAAa;AAClC,oBAAgB,IAAI,cAAc,QAAQ;AAC1C,WAAO;AAAA,EACT;AACF;;;ACrBA,SAAS,oBAAoB,sBAAsB;AAG5C,SAAS,gBAA8C,cAAkC;AAC9F,MAAI,WAAW,IAAI,aAAa;AAChC,QAAM,oBAAoB,mBAAmB;AAE7C,MAAI,mBAAmB;AACrB,mBAAe,MAAM;AACnB,UAAI,kBAAkB,QAAQ,GAAG;AAC/B,YAAI;AACF,UAAC,SAAiD,QAAQ;AAAA,QAC5D,SAAS,OAAO;AACd,kBAAQ,MAAM,2BAA2B,KAAK;AAAA,QAChD;AAAA,MACF;AACA,iBAAW;AAAA,IACb,CAAC;AAAA,EACH;AAEA,SAAO;AACT;;;ACZO,IAAM,QAAkD,CAAC,MAAM,YAAoC;AAExG,MAAI,SAAS,UAAU;AACrB,YAAQ,SAAS,QAAQ,UAAQ;AAC/B,YAAM,kBAAkB,gBAAgB,IAAI,IAAI;AAChD,UAAI,CAAC,iBAAiB;AACpB,wBAAgB,IAAI,MAAM,IAAI,KAAK,CAAC;AAAA,MACtC;AAAA,IACF,CAAC;AAAA,EACH;AACF;;;ACnBA,SAAS,sBAAAA,qBAAoB,kBAAAC,iBAAgB,eAAe;AAGrD,SAAS,iBAA+C,iBAA4C;AACzG,MAAI;AACJ,MAAI,gBAAgB;AAEpB,MAAI,OAAO,oBAAoB,YAAY;AACzC,eAAW,IAAK,gBAAsB;AACtC,oBAAgB;AAAA,EAClB,OAAO;AAEL,eAAW;AAAA,EACb;AAEA,QAAM,cAAc,SAAS;AAC7B,UAAQ,YAAY,MAAM,QAAQ;AAElC,MAAI,eAAe;AACjB,UAAM,oBAAoBC,oBAAmB;AAE7C,QAAI,mBAAmB;AACrB,MAAAC,gBAAe,MAAM;AACnB,YAAI,kBAAkB,QAAQ,GAAG;AAC/B,cAAI;AACF,YAAC,SAAmC,QAAQ;AAAA,UAC9C,SAAS,OAAO;AACd,oBAAQ,MAAM,yCAAyC,KAAK;AAAA,UAC9D;AAAA,QACF;AACA,mBAAW;AAAA,MACb,CAAC;AAAA,IACH;AAAA,EAEF;AACF;;;ACnCA,SAAS,cAAc;AAGhB,SAAS,mBAAiD,cAA8C;AAC7G,SAAO,OAAwB,aAAa,IAAI;AAClD;","names":["getCurrentInstance","onScopeDispose","getCurrentInstance","onScopeDispose"]}